# Google Analytics 4 Pipeline - Data Architecture & Flow

## ğŸ“Š Complete Data Flow Architecture

### **Phase 1: Data Ingestion Flow**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    GOOGLE ANALYTICS 4 DATA PIPELINE - COMPLETE FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Google        â”‚    â”‚   AWS Lambda    â”‚    â”‚   Amazon S3     â”‚    â”‚   AWS Glue      â”‚    â”‚   Glue Catalog  â”‚
â”‚   Analytics 4   â”‚â”€â”€â”€â–¶â”‚   Function      â”‚â”€â”€â”€â–¶â”‚   Landing Zone  â”‚â”€â”€â”€â–¶â”‚   Crawler 1     â”‚â”€â”€â”€â–¶â”‚   Database      â”‚
â”‚   Data API v1   â”‚    â”‚   (ga_ingest.py)â”‚    â”‚   (Raw JSON)    â”‚    â”‚   (Metadata)    â”‚    â”‚   (analytics_  â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚    landing)     â”‚
â”‚   Dimensions:   â”‚    â”‚   - Fetches GA4 â”‚    â”‚   File Format:  â”‚    â”‚   - Scans S3    â”‚    â”‚   Table:        â”‚
â”‚   - date        â”‚    â”‚     data        â”‚    â”‚   ga4_events_   â”‚    â”‚     landing     â”‚    â”‚   ga_events_    â”‚
â”‚   - pagePath    â”‚    â”‚   - Stores JSON â”‚    â”‚   YYYY-MM-DD_   â”‚    â”‚     zone        â”‚    â”‚   landing       â”‚
â”‚   - source      â”‚    â”‚     to S3       â”‚    â”‚   HHMMSS.json   â”‚    â”‚   - Creates     â”‚    â”‚                 â”‚
â”‚   - medium      â”‚    â”‚   - Logs to     â”‚    â”‚                 â”‚    â”‚     table       â”‚    â”‚   Schema:       â”‚
â”‚                 â”‚    â”‚     CloudWatch  â”‚    â”‚   Data: Raw     â”‚    â”‚     schema      â”‚    â”‚   - rows        â”‚
â”‚   Metrics:      â”‚    â”‚                 â”‚    â”‚   GA4 API       â”‚    â”‚   - Updates     â”‚    â”‚   - dimension   â”‚
â”‚   - sessions    â”‚    â”‚   Schedule:     â”‚    â”‚   response      â”‚    â”‚     metadata    â”‚    â”‚     Values      â”‚
â”‚   - totalUsers  â”‚    â”‚   Every 6 hours â”‚    â”‚   (unprocessed) â”‚    â”‚                 â”‚    â”‚   - metric      â”‚
â”‚   - screenPage  â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚   Schedule:     â”‚    â”‚     Values      â”‚
â”‚     Views       â”‚    â”‚   Error:        â”‚    â”‚   Size: ~1-5MB  â”‚    â”‚   Every 6 hours â”‚    â”‚   - processed_  â”‚
â”‚   - eventCount  â”‚    â”‚   CloudWatch    â”‚    â”‚   per file      â”‚    â”‚                 â”‚    â”‚     at          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                        â”‚                        â”‚
                                â–¼                        â–¼                        â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   CloudWatch    â”‚    â”‚   AWS Step      â”‚    â”‚   AWS Glue      â”‚
                       â”‚   Logs          â”‚    â”‚   Functions     â”‚    â”‚   Job 1         â”‚
                       â”‚   (Monitoring)  â”‚    â”‚   (Orchestration)â”‚    â”‚   (ETL Process) â”‚
                       â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
                       â”‚   - Lambda      â”‚    â”‚   - Triggers    â”‚    â”‚   - Reads from  â”‚
                       â”‚     execution   â”‚    â”‚     Lambda      â”‚    â”‚     landing     â”‚
                       â”‚     logs        â”‚    â”‚   - Starts      â”‚    â”‚     table       â”‚
                       â”‚   - Error       â”‚    â”‚     crawlers    â”‚    â”‚   - Transforms  â”‚
                       â”‚     tracking    â”‚    â”‚   - Waits for   â”‚    â”‚     JSON to     â”‚
                       â”‚   - Performance â”‚    â”‚     completion  â”‚    â”‚     structured  â”‚
                       â”‚     metrics     â”‚    â”‚   - Triggers    â”‚    â”‚     data        â”‚
                       â”‚                 â”‚    â”‚     Glue jobs   â”‚    â”‚   - Writes to   â”‚
                       â”‚   Retention:    â”‚    â”‚   - Handles     â”‚    â”‚     raw zone    â”‚
                       â”‚   30 days       â”‚    â”‚     errors      â”‚    â”‚   - Parquet     â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚     format      â”‚
                                                                     â”‚                 â”‚
                                                                     â”‚   Input:        â”‚
                                                                     â”‚   - JSON files  â”‚
                                                                     â”‚   - GA4 API     â”‚
                                                                     â”‚     response    â”‚
                                                                     â”‚                 â”‚
                                                                     â”‚   Output:       â”‚
                                                                     â”‚   - Structured  â”‚
                                                                     â”‚     Parquet     â”‚
                                                                     â”‚   - Partitioned â”‚
                                                                     â”‚     by date     â”‚
                                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                              â”‚
                                                                              â–¼
                                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                     â”‚   Amazon S3     â”‚
                                                                     â”‚   Raw Zone      â”‚
                                                                     â”‚   (Processed)   â”‚
                                                                     â”‚                 â”‚
                                                                     â”‚   File Format:  â”‚
                                                                     â”‚   ga_events_    â”‚
                                                                     â”‚   raw/date=     â”‚
                                                                     â”‚   YYYY-MM-DD/   â”‚
                                                                     â”‚   part-*.parquetâ”‚
                                                                     â”‚                 â”‚
                                                                     â”‚   Schema:       â”‚
                                                                     â”‚   - event_date  â”‚
                                                                     â”‚   - page_path   â”‚
                                                                     â”‚   - traffic_    â”‚
                                                                     â”‚     source      â”‚
                                                                     â”‚   - traffic_    â”‚
                                                                     â”‚     medium      â”‚
                                                                     â”‚   - sessions    â”‚
                                                                     â”‚   - total_users â”‚
                                                                     â”‚   - screen_page_â”‚
                                                                     â”‚     views       â”‚
                                                                     â”‚   - event_count â”‚
                                                                     â”‚   - processed_  â”‚
                                                                     â”‚     at          â”‚
                                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                              â”‚
                                                                              â–¼
                                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                     â”‚   AWS Glue      â”‚
                                                                     â”‚   Crawler 2     â”‚
                                                                     â”‚   (Metadata)    â”‚
                                                                     â”‚                 â”‚
                                                                     â”‚   - Scans S3    â”‚
                                                                     â”‚     raw zone    â”‚
                                                                     â”‚   - Creates     â”‚
                                                                     â”‚     table       â”‚
                                                                     â”‚     schema      â”‚
                                                                     â”‚   - Updates     â”‚
                                                                     â”‚     metadata    â”‚
                                                                     â”‚                 â”‚
                                                                     â”‚   Schedule:     â”‚
                                                                     â”‚   Every 6 hours â”‚
                                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                              â”‚
                                                                              â–¼
                                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                     â”‚   Glue Catalog  â”‚
                                                                     â”‚   Database      â”‚
                                                                     â”‚   (analytics_   â”‚
                                                                     â”‚    raw)         â”‚
                                                                     â”‚                 â”‚
                                                                     â”‚   Table:        â”‚
                                                                     â”‚   ga_events_raw â”‚
                                                                     â”‚                 â”‚
                                                                     â”‚   Schema:       â”‚
                                                                     â”‚   - event_date  â”‚
                                                                     â”‚   - page_path   â”‚
                                                                     â”‚   - traffic_    â”‚
                                                                     â”‚     source      â”‚
                                                                     â”‚   - traffic_    â”‚
                                                                     â”‚     medium      â”‚
                                                                     â”‚   - sessions    â”‚
                                                                     â”‚   - total_users â”‚
                                                                     â”‚   - screen_page_â”‚
                                                                     â”‚     views       â”‚
                                                                     â”‚   - event_count â”‚
                                                                     â”‚   - processed_  â”‚
                                                                     â”‚     at          â”‚
                                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                              â”‚
                                                                              â–¼
                                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                     â”‚   AWS Glue      â”‚
                                                                     â”‚   Job 2         â”‚
                                                                     â”‚   (Redshift     â”‚
                                                                     â”‚    Load)        â”‚
                                                                     â”‚                 â”‚
                                                                     â”‚   - Reads from  â”‚
                                                                     â”‚     raw table   â”‚
                                                                     â”‚   - Cleans data â”‚
                                                                     â”‚   - Loads to    â”‚
                                                                     â”‚     Redshift    â”‚
                                                                     â”‚   - Uses JDBC   â”‚
                                                                     â”‚     connection  â”‚
                                                                     â”‚                 â”‚
                                                                     â”‚   Input:        â”‚
                                                                     â”‚   - Parquet     â”‚
                                                                     â”‚     files       â”‚
                                                                     â”‚   - Structured  â”‚
                                                                     â”‚     data        â”‚
                                                                     â”‚                 â”‚
                                                                     â”‚   Output:       â”‚
                                                                     â”‚   - Redshift    â”‚
                                                                     â”‚     table       â”‚
                                                                     â”‚   - Cleaned     â”‚
                                                                     â”‚     data        â”‚
                                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                              â”‚
                                                                              â–¼
                                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                     â”‚   Amazon        â”‚
                                                                     â”‚   Redshift      â”‚
                                                                     â”‚   (Internal     â”‚
                                                                     â”‚    Tables)      â”‚
                                                                     â”‚                 â”‚
                                                                     â”‚   Database:     â”‚
                                                                     â”‚   analytics     â”‚
                                                                     â”‚                 â”‚
                                                                     â”‚   Table:        â”‚
                                                                     â”‚   ga4_events_   â”‚
                                                                     â”‚   cleaned       â”‚
                                                                     â”‚                 â”‚
                                                                     â”‚   Schema:       â”‚
                                                                     â”‚   - event_date  â”‚
                                                                     â”‚   - page_path   â”‚
                                                                     â”‚   - traffic_    â”‚
                                                                     â”‚     source      â”‚
                                                                     â”‚   - traffic_    â”‚
                                                                     â”‚     medium      â”‚
                                                                     â”‚   - sessions    â”‚
                                                                     â”‚   - total_users â”‚
                                                                     â”‚   - screen_page_â”‚
                                                                     â”‚     views       â”‚
                                                                     â”‚   - event_count â”‚
                                                                     â”‚   - processed_  â”‚
                                                                     â”‚     at          â”‚
                                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                              â”‚
                                                                              â–¼
                                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                     â”‚   DBT Models    â”‚
                                                                     â”‚   (Transform)   â”‚
                                                                     â”‚                 â”‚
                                                                     â”‚   - Reads from  â”‚
                                                                     â”‚     Redshift    â”‚
                                                                     â”‚   - Applies     â”‚
                                                                     â”‚     business    â”‚
                                                                     â”‚     logic       â”‚
                                                                     â”‚   - Creates     â”‚
                                                                     â”‚     calculated  â”‚
                                                                     â”‚     fields      â”‚
                                                                     â”‚   - Writes back â”‚
                                                                     â”‚     to Redshift â”‚
                                                                     â”‚                 â”‚
                                                                     â”‚   Output:       â”‚
                                                                     â”‚   - Enhanced    â”‚
                                                                     â”‚     analytics   â”‚
                                                                     â”‚   - KPIs        â”‚
                                                                     â”‚   - Metrics     â”‚
                                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Phase 2: Data Querying & Analytics Flow**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    DATA QUERYING & ANALYTICS FLOW                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Amazon S3     â”‚    â”‚   Redshift      â”‚    â”‚   Redshift      â”‚    â”‚   Business      â”‚    â”‚   Analytics     â”‚
â”‚   Raw Zone      â”‚â”€â”€â”€â–¶â”‚   Spectrum      â”‚â”€â”€â”€â–¶â”‚   Internal      â”‚â”€â”€â”€â–¶â”‚   Intelligence  â”‚â”€â”€â”€â–¶â”‚   Dashboard     â”‚
â”‚   (Parquet)     â”‚    â”‚   (External     â”‚    â”‚   Tables        â”‚    â”‚   (DBT Models)  â”‚    â”‚   (Tableau/     â”‚
â”‚                 â”‚    â”‚    Tables)      â”‚    â”‚   (Cleaned)     â”‚    â”‚                 â”‚    â”‚    PowerBI)     â”‚
â”‚   Use Cases:    â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚   - Ad-hoc      â”‚    â”‚   - Query S3    â”‚    â”‚   - Fast        â”‚    â”‚   - Calculated  â”‚    â”‚   - Real-time   â”‚
â”‚     queries     â”‚    â”‚     data        â”‚    â”‚     queries     â”‚    â”‚     metrics     â”‚    â”‚     dashboards  â”‚
â”‚   - Data        â”‚    â”‚   - No data     â”‚    â”‚   - Aggregated  â”‚    â”‚   - Business    â”‚    â”‚   - KPIs        â”‚
â”‚     exploration â”‚    â”‚     movement    â”‚    â”‚     views       â”‚    â”‚     rules        â”‚    â”‚   - Reports     â”‚
â”‚   - Cost-       â”‚    â”‚   - Pay per     â”‚    â”‚   - Optimized   â”‚    â”‚   - Data        â”‚    â”‚   - Alerts      â”‚
â”‚     effective   â”‚    â”‚     query       â”‚    â”‚     for speed   â”‚    â”‚     quality      â”‚    â”‚                 â”‚
â”‚   - Large       â”‚    â”‚   - Unlimited   â”‚    â”‚   - Indexed     â”‚    â”‚   - Transform-  â”‚    â”‚   Examples:     â”‚
â”‚     datasets    â”‚    â”‚     scale       â”‚    â”‚     columns     â”‚    â”‚     ations      â”‚    â”‚   - User        â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚     behavior     â”‚
â”‚   Query         â”‚    â”‚   Query         â”‚    â”‚   Query         â”‚    â”‚   Output:       â”‚    â”‚   - Conversion   â”‚
â”‚   Example:      â”‚    â”‚   Example:      â”‚    â”‚   Example:      â”‚    â”‚   - pages_per_  â”‚    â”‚     funnels      â”‚
â”‚   SELECT *      â”‚    â”‚   SELECT        â”‚    â”‚   SELECT        â”‚    â”‚     session     â”‚    â”‚   - Traffic      â”‚
â”‚   FROM          â”‚    â”‚     date,       â”‚    â”‚     event_date, â”‚    â”‚   - sessions_   â”‚    â”‚     sources      â”‚
â”‚   spectrum_     â”‚    â”‚     page_path,  â”‚    â”‚     page_path,  â”‚    â”‚     per_user    â”‚    â”‚   - Page        â”‚
â”‚   analytics.    â”‚    â”‚     sessions    â”‚    â”‚     sessions,   â”‚    â”‚   - events_per_ â”‚    â”‚     performance  â”‚
â”‚   ga_events_raw â”‚    â”‚   FROM          â”‚    â”‚     total_users â”‚    â”‚     session     â”‚    â”‚   - Revenue      â”‚
â”‚   WHERE         â”‚    â”‚   spectrum_     â”‚    â”‚   FROM          â”‚    â”‚                 â”‚    â”‚     tracking     â”‚
â”‚   date >=       â”‚    â”‚   analytics.    â”‚    â”‚   analytics.    â”‚    â”‚   Table:        â”‚    â”‚                 â”‚
â”‚   '2024-01-01'  â”‚    â”‚   ga_events_raw â”‚    â”‚   ga4_events_   â”‚    â”‚   ga4_events_   â”‚    â”‚   Refresh:      â”‚
â”‚                 â”‚    â”‚   WHERE         â”‚    â”‚   cleaned       â”‚    â”‚   enhanced      â”‚    â”‚   Every 6 hours â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   date >=       â”‚    â”‚   WHERE         â”‚    â”‚                 â”‚    â”‚                 â”‚
                       â”‚   '2024-01-01'  â”‚    â”‚   event_date >= â”‚    â”‚   Schema:       â”‚    â”‚   Data Sources: â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   '2024-01-01'  â”‚    â”‚   - All base    â”‚    â”‚   - Redshift    â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚     fields       â”‚    â”‚     internal     â”‚
                                                                     â”‚   - pages_per_  â”‚    â”‚     tables       â”‚
                                                                     â”‚     session     â”‚    â”‚   - DBT models   â”‚
                                                                     â”‚   - sessions_   â”‚    â”‚   - Real-time    â”‚
                                                                     â”‚     per_user    â”‚    â”‚     updates      â”‚
                                                                     â”‚   - events_per_ â”‚    â”‚                 â”‚
                                                                     â”‚     session     â”‚    â”‚   Integration:  â”‚
                                                                     â”‚   - dbt_updated_â”‚    â”‚   - REST APIs    â”‚
                                                                     â”‚     at          â”‚    â”‚   - JDBC/ODBC    â”‚
                                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   - Direct       â”‚
                                                                                            â”‚     queries      â”‚
                                                                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¨ **Colorful Visual Architecture**

### **Data Flow Color Coding:**
- ğŸ”µ **Blue**: Data Sources & External Systems
- ğŸŸ¢ **Green**: Data Processing & Transformation
- ğŸŸ¡ **Yellow**: Data Storage & Persistence
- ğŸŸ  **Orange**: Analytics & Business Intelligence
- ğŸ”´ **Red**: Monitoring & Error Handling
- ğŸŸ£ **Purple**: Orchestration & Workflow

### **Detailed Component Breakdown:**

#### **1. Data Ingestion Layer (ğŸ”µ)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    ğŸ”µ DATA INGESTION LAYER                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ”µ Google     â”‚    â”‚   ğŸŸ¢ AWS Lambda â”‚    â”‚   ğŸŸ¡ Amazon S3  â”‚    â”‚   ğŸŸ¢ CloudWatch â”‚
â”‚   Analytics 4   â”‚â”€â”€â”€â–¶â”‚   Function      â”‚â”€â”€â”€â–¶â”‚   Landing Zone  â”‚â”€â”€â”€â–¶â”‚   Logs          â”‚
â”‚   Data API v1   â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚                 â”‚    â”‚   ğŸ“Š Input:     â”‚    â”‚   ğŸ“ Format:    â”‚    â”‚   ğŸ“ˆ Monitor:   â”‚
â”‚   ğŸ”‘ API Key:   â”‚    â”‚   - GA4 API     â”‚    â”‚   - JSON        â”‚    â”‚   - Lambda      â”‚
â”‚   _02jt4WnSuuaQcâ”‚    â”‚   - Property ID â”‚    â”‚   - Raw data    â”‚    â”‚     execution   â”‚
â”‚   Y0BUCDiA      â”‚    â”‚   - Date range  â”‚    â”‚   - Unprocessed â”‚    â”‚   - Errors      â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚   - Performance â”‚
â”‚   ğŸ†” Property   â”‚    â”‚   ğŸ“¤ Output:    â”‚    â”‚   ğŸ“Š Size:      â”‚    â”‚   ğŸ“… Retention: â”‚
â”‚   ID: 312890004 â”‚    â”‚   - JSON file   â”‚    â”‚   1-5MB/file    â”‚    â”‚   30 days       â”‚
â”‚                 â”‚    â”‚   - S3 upload   â”‚    â”‚   - Timestamped â”‚    â”‚                 â”‚
â”‚   â° Schedule:   â”‚    â”‚   - Logs       â”‚    â”‚   - Partitioned â”‚    â”‚   ğŸ” Alerts:    â”‚
â”‚   Every 6 hours â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚   - Failures    â”‚
â”‚                 â”‚    â”‚   âš¡ Runtime:   â”‚    â”‚   ğŸ—‚ï¸ Structure: â”‚    â”‚   - Timeouts    â”‚
â”‚   ğŸ“Š Metrics:   â”‚    â”‚   300 seconds  â”‚    â”‚   ga4_events_   â”‚    â”‚   - Memory      â”‚
â”‚   - sessions    â”‚    â”‚   ğŸ’¾ Memory:    â”‚    â”‚   YYYY-MM-DD_   â”‚    â”‚                 â”‚
â”‚   - totalUsers  â”‚    â”‚   128 MB       â”‚    â”‚   HHMMSS.json   â”‚    â”‚   ğŸ“Š Metrics:   â”‚
â”‚   - screenPage  â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚   - Duration    â”‚
â”‚     Views       â”‚    â”‚   ğŸ”§ Handler:   â”‚    â”‚   ğŸ”„ Lifecycle: â”‚    â”‚   - Invocations â”‚
â”‚   - eventCount  â”‚    â”‚   ga_ingest.   â”‚    â”‚   - Versioning  â”‚    â”‚   - Errors      â”‚
â”‚                 â”‚    â”‚   lambda_      â”‚    â”‚   - Encryption  â”‚    â”‚   - Throttles   â”‚
â”‚   ğŸ“ Dimensions:â”‚    â”‚   handler      â”‚    â”‚   - Backup      â”‚    â”‚                 â”‚
â”‚   - date        â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚   ğŸ“‹ Logs:      â”‚
â”‚   - pagePath    â”‚    â”‚   ğŸ›¡ï¸ Security: â”‚    â”‚   ğŸ” Access:    â”‚    â”‚   - Request ID  â”‚
â”‚   - source      â”‚    â”‚   - IAM role   â”‚    â”‚   - IAM roles   â”‚    â”‚   - Timestamp   â”‚
â”‚   - medium      â”‚    â”‚   - VPC        â”‚    â”‚   - Bucket      â”‚    â”‚   - Response    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   - Encryption â”‚    â”‚     policies    â”‚    â”‚   - Errors      â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **2. Data Processing Layer (ğŸŸ¢)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    ğŸŸ¢ DATA PROCESSING LAYER                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸŸ¡ S3 Landing â”‚    â”‚   ğŸŸ¢ Glue       â”‚    â”‚   ğŸŸ¡ S3 Raw     â”‚    â”‚   ğŸŸ¢ Glue       â”‚
â”‚   Zone          â”‚â”€â”€â”€â–¶â”‚   Crawler 1     â”‚â”€â”€â”€â–¶â”‚   Zone          â”‚â”€â”€â”€â–¶â”‚   Job 1         â”‚
â”‚   (Raw JSON)    â”‚    â”‚   (Metadata)    â”‚    â”‚   (Parquet)     â”‚    â”‚   (ETL)         â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚   ğŸ“ Input:     â”‚    â”‚   ğŸ” Scans:     â”‚    â”‚   ğŸ“Š Format:    â”‚    â”‚   ğŸ”„ Process:   â”‚
â”‚   - JSON files  â”‚    â”‚   - S3 landing  â”‚    â”‚   - Parquet     â”‚    â”‚   - JSON â†’      â”‚
â”‚   - GA4 API     â”‚    â”‚     zone        â”‚    â”‚   - Structured  â”‚    â”‚     Structured  â”‚
â”‚     response    â”‚    â”‚   - File        â”‚    â”‚   - Optimized   â”‚    â”‚   - Clean data  â”‚
â”‚                 â”‚    â”‚     patterns    â”‚    â”‚   - Compressed  â”‚    â”‚   - Transform   â”‚
â”‚   ğŸ“Š Schema:    â”‚    â”‚   - Schema      â”‚    â”‚   - Partitioned â”‚    â”‚   - Validate    â”‚
â”‚   - rows        â”‚    â”‚     inference   â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚   - dimension   â”‚    â”‚                 â”‚    â”‚   ğŸ“ Structure: â”‚    â”‚   ğŸ“¥ Input:      â”‚
â”‚     Values      â”‚    â”‚   ğŸ“‹ Output:    â”‚    â”‚   ga_events_    â”‚    â”‚   - Landing     â”‚
â”‚   - metric      â”‚    â”‚   - Table       â”‚    â”‚   raw/date=     â”‚    â”‚     table       â”‚
â”‚     Values      â”‚    â”‚     schema      â”‚    â”‚   YYYY-MM-DD/   â”‚    â”‚   - JSON files  â”‚
â”‚   - processed_  â”‚    â”‚   - Metadata    â”‚    â”‚   part-*.parquetâ”‚    â”‚   - GA4 data    â”‚
â”‚     at          â”‚    â”‚   - Statistics  â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚   ğŸ“Š Schema:    â”‚    â”‚   ğŸ“¤ Output:     â”‚
â”‚   ğŸ”„ Schedule:  â”‚    â”‚   â° Schedule:  â”‚    â”‚   - event_date  â”‚    â”‚   - Raw table   â”‚
â”‚   Continuous    â”‚    â”‚   Every 6 hours â”‚    â”‚   - page_path   â”‚    â”‚   - Parquet     â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚   - traffic_    â”‚    â”‚     files       â”‚
â”‚   ğŸ—‚ï¸ Database:  â”‚    â”‚   ğŸ—‚ï¸ Database: â”‚    â”‚     source      â”‚    â”‚   - Cleaned     â”‚
â”‚   analytics_    â”‚    â”‚   analytics_    â”‚    â”‚   - traffic_    â”‚    â”‚     data        â”‚
â”‚   landing       â”‚    â”‚   landing       â”‚    â”‚     medium      â”‚    â”‚                 â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚   - sessions    â”‚    â”‚   ğŸ”§ Technology:â”‚
â”‚   ğŸ“‹ Table:     â”‚    â”‚   ğŸ“‹ Table:     â”‚    â”‚   - total_users â”‚    â”‚   - PySpark     â”‚
â”‚   ga_events_    â”‚    â”‚   ga_events_    â”‚    â”‚   - screen_page_â”‚    â”‚   - Glue        â”‚
â”‚   landing       â”‚    â”‚   landing       â”‚    â”‚     views       â”‚    â”‚   - Dynamic     â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚   - event_count â”‚    â”‚     Frames      â”‚
â”‚   ğŸ” Crawler:   â”‚    â”‚   ğŸ” Crawler:   â”‚    â”‚   - processed_  â”‚    â”‚   - S3          â”‚
â”‚   ga_events_    â”‚    â”‚   ga_events_    â”‚    â”‚     at          â”‚    â”‚   - Parquet     â”‚
â”‚   landing_      â”‚    â”‚   landing_      â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚   crawler       â”‚    â”‚   crawler       â”‚    â”‚   ğŸ”„ Partition: â”‚    â”‚   â° Runtime:    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚   By date       â”‚    â”‚   15-30 min     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **3. Data Warehouse Layer (ğŸŸ¡)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    ğŸŸ¡ DATA WAREHOUSE LAYER                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸŸ¢ Glue Job 2 â”‚    â”‚   ğŸŸ¡ Amazon     â”‚    â”‚   ğŸŸ  DBT Models â”‚    â”‚   ğŸŸ  Analytics  â”‚
â”‚   (Redshift     â”‚â”€â”€â”€â–¶â”‚   Redshift      â”‚â”€â”€â”€â–¶â”‚   (Transform)   â”‚â”€â”€â”€â–¶â”‚   Dashboard     â”‚
â”‚    Load)        â”‚    â”‚   (Internal)    â”‚    â”‚                 â”‚    â”‚   (BI Tools)    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚   ğŸ”„ Process:   â”‚    â”‚   ğŸ—ï¸ Database:  â”‚    â”‚   ğŸ”§ Process:   â”‚    â”‚   ğŸ“Š Visualize: â”‚
â”‚   - Read raw    â”‚    â”‚   analytics     â”‚    â”‚   - Read        â”‚    â”‚   - KPIs        â”‚
â”‚     table       â”‚    â”‚                 â”‚    â”‚     Redshift    â”‚    â”‚   - Charts      â”‚
â”‚   - Clean data  â”‚    â”‚   ğŸ“‹ Table:     â”‚    â”‚   - Apply       â”‚    â”‚   - Reports     â”‚
â”‚   - Load to     â”‚    â”‚   ga4_events_   â”‚    â”‚     business    â”‚    â”‚   - Alerts      â”‚
â”‚     Redshift    â”‚    â”‚   cleaned       â”‚    â”‚     logic       â”‚    â”‚                 â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚   - Calculate   â”‚    â”‚   ğŸ“ˆ Metrics:   â”‚
â”‚   ğŸ“¥ Input:     â”‚    â”‚   ğŸ“Š Schema:    â”‚    â”‚     metrics     â”‚    â”‚   - User        â”‚
â”‚   - Parquet     â”‚    â”‚   - event_date  â”‚    â”‚   - Create      â”‚    â”‚     behavior     â”‚
â”‚     files       â”‚    â”‚   - page_path   â”‚    â”‚     views       â”‚    â”‚   - Conversion   â”‚
â”‚   - Structured  â”‚    â”‚   - traffic_    â”‚    â”‚   - Data        â”‚    â”‚     rates        â”‚
â”‚     data        â”‚    â”‚     source      â”‚    â”‚     quality     â”‚    â”‚   - Traffic      â”‚
â”‚                 â”‚    â”‚   - traffic_    â”‚    â”‚                 â”‚    â”‚     sources      â”‚
â”‚   ğŸ“¤ Output:    â”‚    â”‚     medium      â”‚    â”‚   ğŸ“¤ Output:    â”‚    â”‚   - Page        â”‚
â”‚   - Redshift    â”‚    â”‚   - sessions    â”‚    â”‚   - Enhanced    â”‚    â”‚     performance  â”‚
â”‚     table       â”‚    â”‚   - total_users â”‚    â”‚   - Calculated  â”‚    â”‚   - Revenue      â”‚
â”‚   - Cleaned     â”‚    â”‚   - screen_page_â”‚    â”‚   - Business    â”‚    â”‚     tracking     â”‚
â”‚     data        â”‚    â”‚     views       â”‚    â”‚     fields      â”‚    â”‚                 â”‚
â”‚                 â”‚    â”‚   - event_count â”‚    â”‚   - Business    â”‚    â”‚   ğŸ”„ Refresh:   â”‚
â”‚   ğŸ”§ Technology:â”‚    â”‚   - processed_  â”‚    â”‚     metrics     â”‚    â”‚   Every 6 hours â”‚
â”‚   - JDBC        â”‚    â”‚     at          â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚   - Glue        â”‚    â”‚                 â”‚    â”‚   ğŸ“‹ Table:     â”‚    â”‚   ğŸ› ï¸ Tools:     â”‚
â”‚   - Redshift    â”‚    â”‚   ğŸ” Indexes:   â”‚    â”‚   ga4_events_   â”‚    â”‚   - Tableau     â”‚
â”‚                 â”‚    â”‚   - event_date  â”‚    â”‚   enhanced      â”‚    â”‚   - Power BI    â”‚
â”‚   â° Runtime:    â”‚    â”‚   - page_path   â”‚    â”‚                 â”‚    â”‚   - Looker      â”‚
â”‚   10-20 min     â”‚    â”‚   - traffic_    â”‚    â”‚   ğŸ“Š Schema:    â”‚    â”‚   - Grafana     â”‚
â”‚                 â”‚    â”‚     source      â”‚    â”‚   - All base    â”‚    â”‚   - Custom      â”‚
â”‚   ğŸ›¡ï¸ Security:  â”‚    â”‚                 â”‚    â”‚     fields      â”‚    â”‚     dashboards  â”‚
â”‚   - IAM role    â”‚    â”‚   ğŸ”„ Operations:â”‚    â”‚   - pages_per_  â”‚    â”‚                 â”‚
â”‚   - VPC         â”‚    â”‚   - INSERT      â”‚    â”‚     session     â”‚    â”‚   ğŸ“Š Data       â”‚
â”‚   - Encryption  â”‚    â”‚   - UPDATE      â”‚    â”‚   - sessions_   â”‚    â”‚   Sources:      â”‚
â”‚                 â”‚    â”‚   - DELETE      â”‚    â”‚     per_user    â”‚    â”‚   - Redshift    â”‚
â”‚   ğŸ“Š Preaction: â”‚    â”‚   - SELECT      â”‚    â”‚   - events_per_ â”‚    â”‚     internal     â”‚
â”‚   TRUNCATE      â”‚    â”‚                 â”‚    â”‚     session     â”‚    â”‚     tables       â”‚
â”‚   TABLE         â”‚    â”‚   ğŸ” Access:    â”‚    â”‚   - dbt_updated_â”‚    â”‚   - DBT models  â”‚
â”‚                 â”‚    â”‚   - IAM roles  â”‚    â”‚     at          â”‚    â”‚   - Real-time    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   - Users      â”‚    â”‚                 â”‚    â”‚     updates      â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **4. Data Querying Layer (ğŸŸ )**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    ğŸŸ  DATA QUERYING LAYER                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸŸ¡ S3 Raw     â”‚    â”‚   ğŸŸ  Redshift   â”‚    â”‚   ğŸŸ  Redshift   â”‚    â”‚   ğŸŸ  Business   â”‚
â”‚   Zone          â”‚â”€â”€â”€â–¶â”‚   Spectrum      â”‚â”€â”€â”€â–¶â”‚   Internal      â”‚â”€â”€â”€â–¶â”‚   Intelligence  â”‚
â”‚   (Parquet)     â”‚    â”‚   (External)    â”‚    â”‚   Tables        â”‚    â”‚   (Analytics)   â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚   ğŸ” Use Cases: â”‚    â”‚   ğŸ” Use Cases: â”‚    â”‚   ğŸ” Use Cases: â”‚    â”‚   ğŸ” Use Cases: â”‚
â”‚   - Ad-hoc      â”‚    â”‚   - Query S3    â”‚    â”‚   - Fast        â”‚    â”‚   - Business    â”‚
â”‚     queries     â”‚    â”‚     data        â”‚    â”‚     queries     â”‚    â”‚     metrics     â”‚
â”‚   - Data        â”‚    â”‚   - No data     â”‚    â”‚   - Aggregated  â”‚    â”‚   - KPIs        â”‚
â”‚     exploration â”‚    â”‚     movement    â”‚    â”‚     views       â”‚    â”‚   - Reports     â”‚
â”‚   - Cost-       â”‚    â”‚   - Pay per     â”‚    â”‚   - Optimized   â”‚    â”‚   - Alerts      â”‚
â”‚     effective   â”‚    â”‚     query       â”‚    â”‚     for speed   â”‚    â”‚   - Insights    â”‚
â”‚   - Large       â”‚    â”‚   - Unlimited   â”‚    â”‚   - Indexed     â”‚    â”‚                 â”‚
â”‚     datasets    â”‚    â”‚     scale       â”‚    â”‚     columns     â”‚    â”‚   ğŸ“Š Output:    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚   - Enhanced    â”‚
â”‚   ğŸ“Š Query      â”‚    â”‚   ğŸ“Š Query      â”‚    â”‚   ğŸ“Š Query      â”‚    â”‚     metrics     â”‚
â”‚   Example:      â”‚    â”‚   Example:      â”‚    â”‚   Example:      â”‚    â”‚   - Business    â”‚
â”‚   SELECT *      â”‚    â”‚   SELECT        â”‚    â”‚   SELECT        â”‚    â”‚     insights    â”‚
â”‚   FROM          â”‚    â”‚     date,       â”‚    â”‚     event_date, â”‚    â”‚   - Data        â”‚
â”‚   spectrum_     â”‚    â”‚     page_path,  â”‚    â”‚     page_path,  â”‚    â”‚     quality      â”‚
â”‚   analytics.    â”‚    â”‚     sessions    â”‚    â”‚     sessions,   â”‚    â”‚   - Performance â”‚
â”‚   ga_events_raw â”‚    â”‚   FROM          â”‚    â”‚     total_users â”‚    â”‚     indicators  â”‚
â”‚   WHERE         â”‚    â”‚   spectrum_     â”‚    â”‚   FROM          â”‚    â”‚                 â”‚
â”‚   date >=       â”‚    â”‚   analytics.    â”‚    â”‚   analytics.    â”‚    â”‚   ğŸ“‹ Tables:     â”‚
â”‚   '2024-01-01'  â”‚    â”‚   ga_events_raw â”‚    â”‚   ga4_events_   â”‚    â”‚   - ga4_events_ â”‚
â”‚                 â”‚    â”‚   WHERE         â”‚    â”‚   cleaned       â”‚    â”‚     enhanced     â”‚
â”‚   ğŸ’° Cost:      â”‚    â”‚   date >=       â”‚    â”‚   WHERE         â”‚    â”‚   - ga4_events_ â”‚
â”‚   Pay per       â”‚    â”‚   '2024-01-01'  â”‚    â”‚   event_date >= â”‚    â”‚     kpis         â”‚
â”‚   query         â”‚    â”‚                 â”‚    â”‚   '2024-01-01'  â”‚    â”‚   - ga4_events_ â”‚
â”‚                 â”‚    â”‚   ğŸ’° Cost:      â”‚    â”‚                 â”‚    â”‚     reports      â”‚
â”‚   ğŸ”„ Refresh:   â”‚    â”‚   Pay per       â”‚    â”‚   ğŸ’° Cost:      â”‚    â”‚                 â”‚
â”‚   Every 6 hours â”‚    â”‚   query         â”‚    â”‚   Fixed         â”‚    â”‚   ğŸ”„ Refresh:   â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚   monthly       â”‚    â”‚   Every 6 hours â”‚
â”‚   ğŸ“ Format:    â”‚    â”‚   ğŸ”„ Refresh:   â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚   Parquet       â”‚    â”‚   Real-time     â”‚    â”‚   ğŸ”„ Refresh:   â”‚    â”‚   ğŸ› ï¸ Tools:     â”‚
â”‚   (Optimized)   â”‚    â”‚                 â”‚    â”‚   Every 6 hours â”‚    â”‚   - DBT         â”‚
â”‚                 â”‚    â”‚   ğŸ“ Format:    â”‚    â”‚                 â”‚    â”‚   - SQL         â”‚
â”‚   ğŸ” Access:    â”‚    â”‚   External      â”‚    â”‚   ğŸ“ Format:    â”‚    â”‚   - Python      â”‚
â”‚   IAM roles     â”‚    â”‚   table         â”‚    â”‚   Internal      â”‚    â”‚   - R           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                 â”‚    â”‚   table         â”‚    â”‚                 â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ **Data Flow Summary**

### **Step-by-Step Data Journey:**

1. **ğŸ”µ Data Source**: Google Analytics 4 Data API v1
   - **Input**: API calls with Property ID and date range
   - **Output**: Raw JSON response with dimensions and metrics

2. **ğŸŸ¢ Data Ingestion**: AWS Lambda Function
   - **Input**: GA4 API response
   - **Output**: JSON files stored in S3 Landing Zone
   - **Schedule**: Every 6 hours

3. **ğŸŸ¡ Data Discovery**: Glue Crawler 1
   - **Input**: S3 Landing Zone files
   - **Output**: Table schema in Glue Catalog
   - **Schedule**: Every 6 hours

4. **ğŸŸ¢ Data Processing**: Glue Job 1 (ETL)
   - **Input**: Raw JSON from landing table
   - **Output**: Structured Parquet files in S3 Raw Zone
   - **Transformations**: JSON parsing, data cleaning, partitioning

5. **ğŸŸ¡ Data Discovery**: Glue Crawler 2
   - **Input**: S3 Raw Zone Parquet files
   - **Output**: Table schema in Glue Catalog
   - **Schedule**: Every 6 hours

6. **ğŸŸ¢ Data Loading**: Glue Job 2 (Redshift Load)
   - **Input**: Parquet files from raw table
   - **Output**: Cleaned data in Redshift internal table
   - **Transformations**: Data validation, type casting

7. **ğŸŸ  Data Transformation**: DBT Models
   - **Input**: Redshift internal table
   - **Output**: Enhanced analytics table with calculated metrics
   - **Transformations**: Business logic, KPIs, data quality

8. **ğŸŸ  Data Consumption**: Analytics & BI
   - **Input**: Enhanced tables from Redshift and DBT
   - **Output**: Dashboards, reports, insights
   - **Tools**: Tableau, Power BI, custom dashboards

### **Data Formats & Transformations:**

| Stage | Input Format | Output Format | Key Transformations |
|-------|-------------|---------------|-------------------|
| **Source** | GA4 API JSON | - | API response structure |
| **Landing** | GA4 API JSON | JSON files | File storage, timestamping |
| **Raw** | JSON files | Parquet files | JSON parsing, schema creation, partitioning |
| **Internal** | Parquet files | Redshift table | Data cleaning, type casting, validation |
| **Enhanced** | Redshift table | Enhanced table | Business logic, calculated fields, KPIs |
| **Analytics** | Enhanced table | Dashboards | Visualization, reporting, insights |

This architecture provides a complete data pipeline from raw GA4 data to actionable business insights! ğŸš€ 